<!--
`nuxeo-account_list-search-form`
@group Nuxeo UI
@element nuxeo-account_list-search-form
-->
<link href="../../qualitified-icons.html" rel="import">
<link href="../../elements/nuxeo-document-create-popup-modified.html" rel="import">
<dom-module id="nuxeo-account_list-search-form">
  <template>
    <style include="iron-flex">

      :host {
        display: block;
      }
      .row {
        box-sizing: border-box;
        margin-bottom: 1rem;
        padding: 0 1rem;
        width: 100%;
      }

      label {
        color: #434343;
        font-size: 0.8em;
        font-weight: 700;
        margin-bottom: 5px;
      }

      input {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: .2em;
        box-sizing: border-box;
        color: rgba(0,0,0,.75);
        display: block;
        font-size: 0.8em;
        height: 2rem;
        margin: 0;
        padding: .5rem;
        width: 100%;
      }
      .new{
      position:absolute;
      }
      #scroll{
      height:70vh;
      overflow:auto;}

      @media screen and (min-width: 650px) {
        .resize {

        }
      }

    </style>
    <nuxeo-connection id="nxcon" user="{{currentUser}}"></nuxeo-connection>
    <!-- Full Text -->
    <div class="resize">

    <div id="scroll">
    <nuxeo-input autofocus
                 id="searchInput"
                 label="[[i18n('defaultSearch.fullText')]]"
                 on-keydown="_checkForEnter"
                 placeholder="[[i18n('defaultSearch.fullText.placeholder')]]"
                 role="widget"
                 type="search"
                 value="{{searchTerm}}">
    </nuxeo-input>

    <div class="layout vertical row">
      <label>[[i18n('label.account.type')]]</label>
      <nuxeo-checkbox-aggregation data="[[aggregations.account_type_agg]]" value="{{params.account_type_agg}}">
      </nuxeo-checkbox-aggregation>
    </div>

    <div class="layout vertical row">
      <label>[[i18n('label.metadata.nbemployees')]]</label>
      <nuxeo-checkbox-aggregation data="[[aggregations.nbEmployees_agg]]" multiple="" value="{{params.nbEmployees_agg}}">
      </nuxeo-checkbox-aggregation>
    </div>

    <div class="layout vertical row">
      <label>[[i18n('label.metadata.turnover')]]</label>
      <nuxeo-checkbox-aggregation data="[[aggregations.turnover_agg]]" multiple="" value="{{params.turnover_agg}}">
      </nuxeo-checkbox-aggregation>
    </div>

    <div class="layout vertical row">
      <label>[[i18n('label.metadata.responsible')]]</label>
      <nuxeo-dropdown-aggregation data="[[aggregations.responsible_agg]]" multiple="" value="{{params.responsible_agg}}">
      </nuxeo-dropdown-aggregation>
    </div>
      <div class="layout vertical row">
        <label>multivalued </label>
        <nuxeo-checkbox-aggregation
                data="[[aggregations.stringMultivaluedField1_agg]]"
                value="{{params.stringMultivaluedField1_agg}}"
                multiple="true"
        >
        </nuxeo-checkbox-aggregation>
      </div>
    <div class="layout vertical row">
      <label>status</label>
      <nuxeo-checkbox-aggregation
              data="[[aggregations.account_status_agg]]"
              value="{{params.account_status_agg}}">
      </nuxeo-checkbox-aggregation>
    </div>
    <div class="layout vertical row">
      <label>[[i18n('label.metadata.typeOfIndustry')]]</label>
      <nuxeo-checkbox-aggregation data="[[aggregations.account_industry_type_agg]]" value="{{params.account_industry_type_agg}}">
      </nuxeo-checkbox-aggregation>
    </div>
    <div class="layout vertical row">
      <label>[[i18n('label.metadata.zone')]]</label>
      <nuxeo-checkbox-aggregation data="[[aggregations.account_zone_agg]]" value="{{params.account_zone_agg}}">
      </nuxeo-checkbox-aggregation>
    </div>

    <!-- Create a new Account -->
    </div>
    <div class="actions layout vertical style-scope nuxeo-search-form">
      <paper-button class="primary horizontal layout center" elevation="0" id="new" noink="" on-tap="_openDialog">
        <iron-icon icon="qualitified:account"></iron-icon> [[i18n('command.new.account')]]
      </paper-button>
    </div>

    <nuxeo-document auto
                    doc-path="/Sales"
                    enrichers="permissions, subtypes"
                    id="defaultDoc"
                    response="{{parent}}">
    </nuxeo-document>

    <nuxeo-document-create-popup-modified default-path="/Sales"
                                          id="importPopup"
                                          parent="[[parent]]">
    </nuxeo-document-create-popup-modified>
    <!-- /Create a new Account -->
    </div>
  </template>

  <script>
    Polymer({
      is: 'nuxeo-account_list-search-form',
      behaviors: [Nuxeo.LayoutBehavior, Nuxeo.RoutingBehavior, Nuxeo.FormatBehavior, Nuxeo.DocumentCreationBehavior],
      properties: {

        /**
         * @search account_list
         */
        params: {
          type: Object,
          value: {},
          notify: true,
        },
        aggregations: {
          type: Object,
          value: {},
          notify: true,
        },
        searchTerm: {
          type: String,
          notify: true,
          observer: '_addFullTextSearch'
        }
      },
      _addFullTextSearch: function() {
        if (this.searchTerm) {
          console.log(this.searchTerm);
          this.set('params.system_fulltext', this.searchTerm + '*');
        } else {
          if (this.params.system_fulltext) {
            this.set('params.system_fulltext', '');
            delete this.params.system_fulltext;
          }
        }
      },
      _checkForEnter: function(e) {
        if (e.keyCode === 13) {
          this.fire('trigger-search');
        }
      },

      clear: function() {
        this.searchTerm = '';
      },

      _openDialog: function() {
        this.$.importPopup.toggleDialog();
        var accountBtn;
        var docTypes = this.$.importPopup.shadowRoot.querySelector('#simpleCreation').shadowRoot.querySelector('iron-pages > div.vertical.iron-selected > div.container > paper-dialog-scrollable > div').getElementsByClassName('docTypeButton');
        for (var i = 0; i < docTypes.length; i++) {
          //docTypes[i].hidden = true;
          if(docTypes[i].getAttribute('name') === "Account"){
            accountBtn = docTypes[i];
            accountBtn.click();
            return;
          }
        }

      }
    });
  </script>
</dom-module>
