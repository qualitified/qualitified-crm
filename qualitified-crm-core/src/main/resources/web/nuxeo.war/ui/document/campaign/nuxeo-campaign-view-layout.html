<link href="../qualitified-custom-fields.html" rel="import">
<dom-module id="nuxeo-campaign-view-layout">
    <template>
        <style include="nuxeo-styles shared-css">
            *[role=widget] {
                padding: 5px;
            }

            nuxeo-data-table {
                height: 100%;
            }

            .dataTable{
                /*height: 300px;*/
            }

            .queue-thumbnail {
                height: 32px;
                width: 32px;
                border-radius: 20px;
                box-sizing: border-box;
                margin-right: 8px;
            }

            .queue-thumbnail ::content img {
                height: 32px;
                width: 32px;
                border-radius: 20px;
                box-sizing: border-box;
                margin-right: 8px;
            }
            .results {
                @apply(--layout-vertical);
                @apply(--layout-flex);
                /* min-height: calc(60vh - 14em); */
                /*margin-top: 8px;*/
            }


        </style>

        <nuxeo-page-provider id="provider" provider="default_content_collection" schemas="dublincore,person,common" page-size="40" enrichers="thumbnail, permissions">
        </nuxeo-page-provider>

        <nuxeo-default-results id="results" name="[[document.uid]]" items="{{items}}" on-navigate="_navigate" selected-items="{{selectedItems}}" empty-label="[[i18n('collections.noDocument')]]" empty-label-when-filtered="[[i18n('collections.noDocumentWhenFiltered')]]" hide-content-view-actions="">
            <div slot="selectionActions">
                <nuxeo-slot slot="COLLECTION_ACTIONS" model="[[actionContext]]"></nuxeo-slot>
            </div>
        </nuxeo-default-results>
    </template>

    <script>
        (function() {
            'use strict';
            Polymer({
                is: 'nuxeo-campaign-view-layout',

                behaviors: [Nuxeo.LayoutBehavior, Nuxeo.FiltersBehavior],
                properties: {

                    /**
                     * @doctype Campaign
                     */
                    document: {
                        type: Object,
                        observer: '_documentChanged'
                    },
                    actionContext: {
                        type: Object,
                        computed: '_actionContext(document, selectedItems)'
                    },
                    params: {
                        type: Object,
                        value: {},
                        notify: true
                    }
                },
                observers: [
                    '_observeDocument(document)'
                ],

                _observeDocument: function() {
                    if (this.document) {
                        this.params = {'ecm_parentId': this.document.uid};
                    }
                },


                _navigate: function(e) {
                    var detail = {
                        doc: e.detail.item,
                    };
                    if(detail.doc){
                        page('/browse' + detail.doc.path);
                    }
                },


                _documentChanged: function () {
                    if (this.document && this.hasFacet(this.document, 'Collection')) {
                        this.$.results.nxProvider = this.$.provider;
                        this.$.provider.params = [this.document.uid];
                        this.$.provider.page = 1;
                        this.fire('collection-loaded', {collection: this.document, provider: this.$.provider});
                        this.$.results._refreshAndFetch();
                    }
                },
                _actionContext: function () {
                    return {collection: this.document, selectedItems: this.selectedItems, items: this.$.results.items};
                },


            });
        })();
    </script>
</dom-module>