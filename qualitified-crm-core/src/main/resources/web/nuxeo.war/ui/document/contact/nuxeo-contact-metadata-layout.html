<link rel="import" href="../qualitified-custom-fields.html">
<dom-module id="nuxeo-contact-metadata-layout">
    <template>
        <style>
            *[role=widget] {
                padding: 5px;
            }
            .account-view-layout {
                height: 32px;
                width: 32px;
                border-radius: 20px;
                box-sizing: border-box;
                margin-right: 8px;
            }

        </style>

        <div role="widget" class="title">
            <h1>
                <template is="dom-if" if="[[_hasProfileImg(document.properties.file:content)]]">
                    <img style="vertical-align: text-bottom;" class="account-view-layout"
                         src="/nuxeo/nxfile/default/[[document.uid]]/file:content/">
                </template>
                [[document.properties.dc:title]]
            </h1>
        </div>

        <div role="widget">
            <qualitified-inline-edit document="[[document]]"
                                     property="person:Role"
                                     label="[[i18n('label.metadata.role')]]"
                                     metadata="directory"
                                     directory="Role"
                                     value="[[formatDirectory(document.properties.person:Role)]]"
            >

            </qualitified-inline-edit>
        </div>

        <div role="widget">
            <qualitified-inline-edit document="[[document]]"
                                     property="person:email"
                                     value="[[document.properties.person:email]]"
                                     label="[[i18n('label.metadata.email')]]"
            >
            </qualitified-inline-edit>
        </div>

        <div role="widget">
            <qualitified-inline-edit document="[[document]]"
                                     property="person:phoneNumber"
                                     value="[[document.properties.person:phoneNumber]]"
                                     label="[[i18n('label.metadata.phone')]]"
            >
            </qualitified-inline-edit>
        </div>
        <div role="widget">
            <qualitified-inline-edit document="[[document]]"
                                     property="address:address1"
                                     value="[[document.properties.address:address1]]"
                                     label="[[i18n('label.metadata.address')]] 1"
            >
            </qualitified-inline-edit>
            <qualitified-inline-edit document="[[document]]"
                                     property="address:address2"
                                     value="[[document.properties.address:address2]]"
                                     label="[[i18n('label.metadata.address')]] 2"

            >
            </qualitified-inline-edit>
            <qualitified-inline-edit document="[[document]]"
                                     property="address:address3"
                                     value="[[document.properties.address:address3]]"
                                     label="[[i18n('label.metadata.address')]] 3"
            >
            </qualitified-inline-edit>
            <qualitified-inline-edit document="[[document]]"
                                     property="address:zipCode"
                                     value="[[document.properties.address:zipCode]]"
                                     label="[[i18n('label.metadata.zipCode')]]"
            >
            </qualitified-inline-edit>
            <qualitified-inline-edit document="[[document]]"
                                     property="address:city"
                                     value="[[document.properties.address:city]]"
                                     label="[[i18n('label.metadata.city')]]"
            >
            </qualitified-inline-edit>
            <qualitified-inline-edit document="[[document]]"
                                     property="address:country"
                                     value="[[document.properties.address:country]]"
                                     label="[[i18n('label.metadata.country')]]"
            >
            </qualitified-inline-edit>

        </div>
        <div role="widget">
            <div role="widget">
                <qualitified-inline-edit document="[[document]]"
                                         value="[[item.properties.contact:responsible]]"
                                         property="contact:responsible"
                                         label="label.metadata.responsible"
                                         metadata="user"></qualitified-inline-edit>


            </div>

            <div role="widget" hidden$="[[!document.properties.person:language]]" >
                <qualitified-inline-edit document="[[document]]"
                                         property="person:language"
                                         label="[[i18n('label.metadata.language')]]"
                                         metadata="directory"
                                         directory="contactLanguage"
                                         value="[[formatDirectory(document.properties.person:language)]]"
                >

                </qualitified-inline-edit>

            </div>
            <div role="widget">
                <qualitified-inline-edit document="[[document]]"
                                         property="dc:description"
                                         value="[[document.properties.dc:description]]"
                                         label="[[i18n('label.metadata.description')]]"
                >
                </qualitified-inline-edit>
            </div>
            <qualitified-custom-fields document="{{document}}" mode="view"></qualitified-custom-fields>
    </template>

    <script>
        (function() {
            'use strict';
            Polymer({
                is: 'nuxeo-contact-metadata-layout',
                behaviors: [Nuxeo.LayoutBehavior],
                properties: {

                    /**
                     * @doctype Contact
                     */
                    document: {
                        type: Object
                    },

                },
                /**
                 * Returns the label for the given directory entry.
                 */
                formatDirectory: function(value) {
                    if (value && value['entity-type'] && value['entity-type'] === 'directoryEntry') {
                        if (value.properties && value.properties.label) {
                            return value.properties.label;
                        } else {
                            var label = 'label_' + ((window.nuxeo.I18n.language) ? window.nuxeo.I18n.language.split('-')[0] : 'en');
                            return value.properties[label] || value.properties['label_en']
                        }
                    } else {
                        return value;
                    }
                },
                _hasProfileImg: function(value){
                    if(value != null){
                        return true;
                    }
                    return false;
                }
            });
        })();

    </script>
</dom-module>
