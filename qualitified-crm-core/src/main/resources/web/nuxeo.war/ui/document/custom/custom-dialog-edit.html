<!--
`nuxeo-custom-edit-layout`
@group Nuxeo UI
@element nuxeo-custom-edit-layout
-->
<dom-module id="custom-dialog-edit">
    <template>
        <style>
      *[role=widget] {
        padding: 5px;
      }
      .results {
        @apply(--layout-vertical);
        @apply(--layout-flex);
        min-height: calc(100vh - 14em);
        margin-top: 8px;
      }
      .container {
        overflow: auto;
        flex: 1 1 auto;
        height: 400px;
      }
    </style>
        <nuxeo-input role="widget" value="{{item.label}}" label="Label"></nuxeo-input>
        <nuxeo-directory-suggestion role="widget" label="Type"
                                    directory-name="Type"
                                    name="Type"
                                    value="{{item.type}}"
                                    min-chars="0"  on-value-changed="_getVocabulary" >
        </nuxeo-directory-suggestion>
        <nuxeo-select role="widget"
                      label="fieldName"
                      options="[[newList]]"
                      on-click="_getAvailableField"
                      selected="{{item.fieldName}}"
        >
        </nuxeo-select>
        <paper-checkbox checked="{{item.required}}"></paper-checkbox> Required
        <nuxeo-input role="widget" value="{{item.vocabularyName}}" label="Vocabulary Name"></nuxeo-input>
        <nuxeo-input role="widget" value="{{item.format}}" label="Format"></nuxeo-input>
        <nuxeo-input role="widget" value="{{item.readGroup}}" label="Read Group"></nuxeo-input>
        <nuxeo-input role="widget" value="{{item.editGroup}}" label="Edit Group"></nuxeo-input>
        <nuxeo-input role="widget" value="{{item.hiddenGroup}}" label="Hidden Group"></nuxeo-input>
        <paper-checkbox checked="{{item.multivalue}}"></paper-checkbox> Multivalue
        <nuxeo-input role="widget" value="{{item.primaryType}}" label="Primary Type"></nuxeo-input>
        <nuxeo-input role="widget" value="{{item.path}}" label="Path"></nuxeo-input>
        <nuxeo-input role="widget" value="{{item.parentId}}" label="Parent Id"></nuxeo-input>
        <paper-checkbox checked="{{item.multiline}}"></paper-checkbox> Multiline <br/>
        <paper-checkbox checked="{{item.link}}"></paper-checkbox> Link
    </template>
    <script>
    (function() {
      'use strict';
      Polymer({
        is: 'custom-dialog-edit',
        behaviors: [Nuxeo.LayoutBehavior,Polymer.IronResizableBehavior,Polymer.IronValidatableBehavior],
        properties: {
          /**
           * @doctype Custom
           */
          document: {
            type: Object
          },
          item: {
            type: Object
          },
          vocabEntries:{
          type: Array,
          value: []
        },


        newList: {
        type: Array,
          value: []
      },
        },
        _getAvailableField:function(){
      var newList=[];
      var vocabs=this.vocabEntries;
      console.log("doc "+this.document);
      var customField= this.document.properties["custom:field"];
      var fieldNameList=[];
      for(var j=0;j<customField.length;j++){
        fieldNameList.push(customField[j].fieldName);
      }
      for(var i=0;i<vocabs.length;i++){
        if (fieldNameList.indexOf(vocabs[i].id) === -1) {
          newList.push({id:vocabs[i].id,label:vocabs[i].id});
        }
        else if (customField.indexOf(vocabs[i].id) > -1) {
            console.log(vocabs[i] + ' already exists in the customField collection.');
        }
      }
     this.newList=newList;
    },
       ready: function () {
          //TODO add the following values in a vocabulary
          this.types = [
            {id: 'string', label: 'String'},
            {id: 'double', label: 'Double'},
            {id: 'integer', label: 'Integer'},
            {id: 'date', label: 'Date'},
            {id: 'boolean', label: 'Boolean'}
          ];},
    _getVocabulary: function(e) {
         var selection= e.detail.value;
        var fieldnameId= document.querySelector("body > nuxeo-app").shadowRoot.querySelector("#browser").shadowRoot.querySelector("nuxeo-page > div:nth-child(1) > div > nuxeo-actions-menu > nuxeo-document-edit-button").shadowRoot.querySelector("nuxeo-document-form-button").shadowRoot.querySelector("#layout").shadowRoot.querySelector("#layout").shadowRoot.querySelector("#layout").shadowRoot.querySelector("#container > nuxeo-custom-edit-layout").shadowRoot.querySelector("#tab > nuxeo-data-table-form").shadowRoot.querySelector("#container > custom-dialog-edit").shadowRoot.querySelector("nuxeo-select");
         //var fieldnameId=document.querySelector("nuxeo-app").shadowRoot.querySelector("#browser").shadowRoot.querySelector("nuxeo-document-edit-button").shadowRoot.querySelector("nuxeo-document-form-button").shadowRoot.querySelector("#layout").shadowRoot.querySelector("#layout").shadowRoot.querySelector("#layout").shadowRoot.querySelector("nuxeo-custom-edit-layout");
         if(fieldnameId!==null){
         fieldnameId.setAttribute("directory-Name", selection);
         fetch(window.location.origin + '/nuxeo/api/v1/directory/'+selection)
        .then((resp) => resp.json())
        .then(function(data) {
        this.vocabEntries = data.entries;
       }.bind(this));
        }
      },

       });
    })();
  </script>
</dom-module>