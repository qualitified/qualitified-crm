<!--
  Created by mmakni on 18-12-2018
  mmakni@qualitified.com
-->
<dom-module id="qualitified-pipeline">
  <template>
    <style include="nuxeo-styles grid-styles">
          #board {
            height: calc(100%);
            overflow: hidden;
          }
          #board .column {
            width: 24%;
            float: left;
            position: relative;
            height: calc(100%);
          }
          #board .column:last-child {
            border-right-color: transparent;
          }
          #board .column.over, #board .column.over:last-child {
            border: dashed 1px #555;
            background-color: #efefef;
          }
  
          .over {
            /*background-color: #55555559;*/
          }
  
          .drop{
            min-height: 600px;
          }
  
          nuxeo-card{
            margin-bottom: 2px;
            margin-left: 5px;
            margin-right: 5px;
            cursor:pointer;
          }
  
          .footerContainer{
            position: fixed;
            bottom: 0px;
            width: 100%;
            height: 0px;
            bottom: +100px;
          }

          .footer{
            width: 18%;
            height:100px;
            float: left;
            color: #fff;
            font-weight: bold;
            position: relative;
            bottom: -70px;
          }

          .lost {
              background-color: #f44336;
          }

          .won {
              background-color: #8BC34A;
          }

          .nogo {
              background-color: #FF9800;
          }

          .limbo {
              background-color: #03A9F4;
          }

          .lostText {
              color: #f44336;
          }

          .wonText {
              color: #8BC34A;
          }

          .nogoText {
              color: #FF9800;
          }

          .limboText {
              color: #03A9F4;
          }

          .footerDrop{
            bottom: 0px;
          }

          iron-icon.icon{
            color:#fff;;
            width:100px;
            height:100px;
            position: absolute;
            right: -25px;
          }

          .slider {
                width:100px;
                height:20px;
                position:absolute;
                top:10px;
                bottom:0;
                left:21px;
                transition:1s ease;
            }

            .slide {
                top:-50px;
            }

      </style>

    <div id="board">
      <div class="column">
        <div class="header"><h4>New<br/>$ 2,200,000</h4><iron-icon class="icon" icon="icons:chevron-right"></iron-icon></div>
        <div class="drop" on-drop="drop" on-dragover="allowDrop" on-dragleave="dragLeave">
          <nuxeo-card id="card-1" draggable="true" on-dragstart="drag" class="card" draggable="true">
            [GOOGLE] CCM Project <br/><b>$ 1,000,000</b><br/>Michael GENA
          </nuxeo-card>
          <nuxeo-card id="card-2" draggable="true" on-dragstart="drag" class="card" draggable="true">
            [LINKEDIN] CCM Project for Yest...<br/><b>$ 1,200,000</b><br/>John DOE
          </nuxeo-card>
        </div>
      </div>
      <div class="column">
        <div class="header"><h4>First Contact/Demo<br/>$ 2,000,000</h4><iron-icon class="icon"icon="icons:chevron-right"></iron-icon></div>
        <div class="drop" on-drop="drop" on-dragover="allowDrop" on-dragleave="dragLeave">
          <nuxeo-card id="card-3" draggable="true" on-dragstart="drag" class="card" draggable="true">
            [AMAZON] CCM Project Phase 1<br/><b>$ 2,000,000</b><br/>Michael GENA
          </nuxeo-card>
        </div>
      </div>
      <div class="column">
        <div class="header"><h4>Proposal Sent<br/>$ 7,300,000</h4><iron-icon class="icon" icon="icons:chevron-right"></iron-icon></div>
        <div class="drop" on-drop="drop" on-dragover="allowDrop" on-dragleave="dragLeave">
          <nuxeo-card id="card-5" draggable="true" on-dragstart="drag" class="card" draggable="true">
            [TESLA] CCM Project Prototype<br/><b>$ 1,800,000</b><br/>John DOE
          </nuxeo-card>
          <nuxeo-card id="card-6" draggable="true" on-dragstart="drag" class="card" draggable="true">
            [CAPITAL ONE] CCM Project Prototype<br/><b>$ 2,500,000</b><br/>John DOE
          </nuxeo-card>
          <nuxeo-card id="card-7" draggable="true" on-dragstart="drag" class="card" draggable="true">
            [WARNERBROS] CCM Project Prototype<br/><b>$ 5,000,000</b><br/>John DOE
          </nuxeo-card>
        </div>
      </div>
      <div class="column">
        <div class="header"><h4>Negociation<br/>$ 800,000</h4><iron-icon class="icon" icon="icons:chevron-right"></iron-icon></div>
        <div class="drop" on-drop="drop" on-dragover="allowDrop" on-dragleave="dragLeave">
          <nuxeo-card id="card-4" draggable="true" on-dragstart="drag" class="card" draggable="true">
            [APPLE] CCM Project Prototype<br/><b>$ 800,000</b><br/>John DOE
          </nuxeo-card>
        </div>
      </div>
    </div>
    <div class="footerContainer">
      <div id="limbo" class="footer limbo" on-dragleave="dragLeave" on-drop="dropFooter" on-dragover="allowDropFooter">
        Limbo <span id="limboAmount">$ 2,980,000</span><div id="newlimboAmount" class="limboText slider">+ $ 1,500,000</div>
      </div>
      <div id="nogo" class="footer nogo" on-dragleave="dragLeave" on-drop="dropFooter" on-dragover="allowDropFooter">
        No Go <span id="nogoAmount">$ 1,000,000</span><div id="newnogoAmount" class="nogoText slider">+ $ 2,500,000</div>
      </div>
      <div id="won" class="footer won" on-dragleave="dragLeave" on-drop="dropFooter" on-dragover="allowDropFooter">
        Won <span id="wonAmount">$ 1,500,000</span><div id="newwonAmount" class="wonText slider">+ $ 2,000,000</div>
      </div>
      <div id="lost" class="footer lost" on-dragleave="dragLeave" on-drop="dropFooter" on-dragover="allowDropFooter">
        Lost <span id="lostAmount">$ 500,000</span><div id="newlostAmount" class="lostText slider">+ $ 500,000</div>
      </div>
    </div>

  </template>

  <script>
      Polymer({
        is: 'qualitified-pipeline',
        behaviors: [Nuxeo.RoutingBehavior, Nuxeo.FormatBehavior, Nuxeo.ChartDataBehavior, Report.DataBehavior],
        properties: {
        },
        allowDrop:function(ev){
            ev.preventDefault();
            ev.currentTarget.classList.add('over');
        },
        allowDropFooter:function(ev){
            ev.preventDefault();
            ev.currentTarget.classList.add('footerDrop');
        },
        drag: function(ev){
            ev.dataTransfer.setData("text",ev.target.id);
            ev.currentTarget.classList.add('dragging');
        },
        drop:function(ev){
            ev.preventDefault();
            var data=ev.dataTransfer.getData("text");
            console.log(ev.target.localName);
            if(ev.target.localName === 'div'){
              ev.target.appendChild(this.shadowRoot.querySelector('#' + data));
              ev.target.classList.remove('over');
            }
            if(ev.target.localName === 'nuxeo-card'){
              ev.target.parentNode.appendChild(this.shadowRoot.querySelector('#' + data));
              ev.target.parentNode.classList.remove('over');
            }
            this.shadowRoot.querySelector('#' + data).classList.remove('dragging');
            this.shadowRoot.querySelectorAll('over').forEach(function(drop){
              drop.classList.remove('over');
            });
        },
        dropFooter: function(ev){
            ev.preventDefault();
            var data=ev.dataTransfer.getData("text");
            console.log(ev.target.localName);
            ev.target.classList.remove('footerDrop');

            this.shadowRoot.querySelector('#new'+ev.target.id+'Amount').classList.add('slide');
            if(ev.target.id === 'limbo'){
              setTimeout(function(){
                this.shadowRoot.querySelector('#newlimboAmount').classList.remove('slide');
              }.bind(this),2000);
            }
            if(ev.target.id === 'nogo'){
              setTimeout(function(){
                this.shadowRoot.querySelector('#newnogoAmount').classList.remove('slide');
              }.bind(this),2000);
            }
            if(ev.target.id === 'won'){
              setTimeout(function(){
                this.shadowRoot.querySelector('#newwonAmount').classList.remove('slide');
              }.bind(this),2000);
            }
            if(ev.target.id === 'lost'){
              setTimeout(function(){
                this.shadowRoot.querySelector('#newlostAmount').classList.remove('slide');
              }.bind(this),2000);
            }

            this.shadowRoot.querySelector('#'+ev.target.id+'Amount').innerHTML="$ 2,000,000";
            this.shadowRoot.querySelector('#' + data).remove();
        },
        dragLeave: function(ev){
          ev.preventDefault();
          ev.target.classList.remove('footerDrop');
          ev.target.classList.remove('over');
        }
  
      });
    </script>
</dom-module>
  