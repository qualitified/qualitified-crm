<!--
`qualitified-add-to-campaign-button`
@group Nuxeo UI
@element qualitified-add-to-campaign-button
-->
<dom-module assetpath="nuxeo-document-bulk-actions/" id="qualitified-add-to-campaign-button">
    <template>
        <style include="nuxeo-action-button-styles">
      :host([hidden]) {
        display: none;
      }
      paper-dialog-scrollable {
        --paper-dialog-scrollable: {
          -webkit-overflow-scrolling: auto;
        };
      }
        </style>
        <nuxeo-operation id="addToCollectionOp" input="[[input]]" op="Document.AddToCollection"></nuxeo-operation>
        <nuxeo-operation id="createCollectionOp" op="Collection.Create"></nuxeo-operation>
        <paper-icon-button icon="icons:add-box" id="button" on-tap="_toggleDialog"></paper-icon-button>
        <paper-tooltip for="button">Add to Campaign</paper-tooltip>
        <nuxeo-dialog id="add-to-collection-dialog" no-auto-focus="" on-iron-overlay-closed="_resetPopup"
                      with-backdrop="">
            <h2> [[i18n('addToCampaignButton.dialog.add')]]</h2>
            <paper-dialog-scrollable>
                <qualitified-document-suggestion
                        label="[[i18n('label.metadata.campaign.title')]]"
                        min-chars="0"
                        page-provider="documents"
                        params='{ "namedParameters": "system_primaryType=Campaign"}'
                        role="widget"
                        value="{{collection}}"></qualitified-document-suggestion>
            </paper-dialog-scrollable>
            <div class="buttons">
                <paper-button dialog-dismiss="">[[i18n('addToCollectionButton.dialog.cancel')]]</paper-button>
                <paper-button class="primary" dialog-confirm="" on-tap="_addCampaign">
                    [[i18n('addToCollectionButton.dialog.add')]]
                </paper-button>
            </div>
        </nuxeo-dialog>
    </template>
    <script>
(function() {
  'use strict';
  Polymer({
      is: 'qualitified-add-to-campaign-button',
      behaviors: [Nuxeo.I18nBehavior,Polymer.IronResizableBehavior,Nuxeo.LayoutBehavior,Nuxeo.RoutingBehavior, Nuxeo.FormatBehavior,Nuxeo.FiltersBehavior],
      properties: {
       /**
         * @doctype campaign
       */
        document: {
          type: Object,
          observer:'_documentReady'
        },
        collection: {
              type: String,
              value: '',
            },
             selectedItems: {
          type: Object
        },

        _label: {
          type: String,
          computed: '_computeLabel(i18n)',
        }
        },
        _documentReady: function(doc){
        console.log(this.document);
        },
        _isAvailable:function(doc) {
          return this.isCollectionMember(doc);
        },
        _computeLabel:function() {
          return this.i18n('addToCollectionButton.tooltip');
        },
        _toggleDialog:function() {
          this.$['add-to-collection-dialog'].toggle();
        },

        _addCampaign:function() {
          if (this.selectedItems !== null && this.selectedItems.length > 0) {
            this.input = this.selectedItems;
            const op = this.$.addToCollectionOp;
            op.params = {
                collection: this.collection,
            };
            op.execute().then(() => {
                this._resetPopup();
            });
          }
        },

        _resetPopup:function() {
          this.set('collection', null);
          this.description = '';
        }
  });
})();

    </script>
</dom-module>